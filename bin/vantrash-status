#!/usr/bin/perl
use lib 'lib';
use FindBin;
use App::VanTrash::Model;
use Getopt::Long;

my $base_path = "$FindBin::Bin/..";
my $verbose;
my $reminder;
GetOptions(
    'base-path=s' => \$base_path,
    'v|verbose'   => \$verbose,
    'reminder=s'  => \$reminder,
) or die "USAGE: $0 --base-path=foo";

my $model = App::VanTrash::Model->new(
    base_path => $base_path,
);

if ($reminder) {
    my $r = $model->reminders->by_id($reminder);
    die "Could not find reminder '$reminder'\n" unless $r;
    print $r->dump;
    exit;
}

my $zones = $model->zones;
print "Zones: " . @$zones . "\n";
for my $z (@$zones) {
    print "  $z\n";
}

my $reminders = $model->reminders->all;
print "Reminders: " . @$reminders . "\n";
for my $r (@$reminders) {
    my $id = $r->id;
    my $email = $r->email;
    my $zone = $r->zone;
    my $confirmed = $r->confirmed ? 'confirmed' : 'unconfirmed';
    print "  $id - $zone\t- $email - $confirmed\n";
}
